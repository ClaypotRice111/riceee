<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riceee Hub - ç§äººèµ„æºåº“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* åŠ è½½ä¸­çš„éª¨æ¶å±åŠ¨ç”» */
        .skeleton { background: #e5e7eb; border-radius: 0.5rem; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen text-gray-800 font-sans">

<nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-8">
                <a href="#" onclick="navigateTo('home')" class="flex items-center gap-2 text-xl font-bold text-gray-900 hover:text-orange-600 transition-colors">
                    <i data-lucide="folder" class="w-6 h-6 text-orange-600"></i>
                    Riceee
                </a>

                <div id="desktop-nav" class="hidden md:flex gap-1 hidden">
                    <button onclick="navigateTo('links')" class="nav-btn px-4 py-2 rounded-xl font-medium text-gray-600 hover:bg-gray-50 transition-all" data-page="links">é“¾æ¥</button>
                    <button onclick="navigateTo('projects')" class="nav-btn px-4 py-2 rounded-xl font-medium text-gray-600 hover:bg-gray-50 transition-all" data-page="projects">é¡¹ç›®</button>
                    <button onclick="navigateTo('files')" class="nav-btn px-4 py-2 rounded-xl font-medium text-gray-600 hover:bg-gray-50 transition-all" data-page="files">æ–‡ä»¶</button>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <div id="auth-buttons" class="flex items-center gap-3">
                    <button onclick="openAuthModal('login')" class="hidden md:block px-4 py-2 bg-orange-600 text-white rounded-xl font-medium hover:bg-orange-700 transition-all">ç™»å½•</button>
                </div>

                <div id="user-menu" class="hidden flex items-center gap-3">
                    <button onclick="navigateTo('settings')" class="hidden md:block p-2 text-gray-600 hover:text-orange-600 hover:bg-gray-50 rounded-xl transition-all" title="è®¾ç½®">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                    </button>
                    <button onclick="logout()" class="hidden md:block p-2 text-gray-600 hover:text-red-600 hover:bg-gray-50 rounded-xl transition-all" title="é€€å‡º">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                    </button>
                </div>

                <button class="md:hidden p-2 text-gray-600">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
    </div>
</nav>

<main id="app-content" class="min-h-[calc(100vh-73px)]">
</main>

<div id="auth-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 hidden fade-in">
    <div class="bg-white rounded-3xl shadow-xl max-w-md w-full p-8 relative">
        <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
            <i data-lucide="x" class="w-6 h-6"></i>
        </button>
        <h2 id="modal-title" class="text-2xl font-bold text-gray-900 mb-6">ç™»å½•</h2>

        <form id="auth-form" onsubmit="handleAuthSubmit(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ç”¨æˆ·å</label>
                <input type="text" id="username" required class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:outline-none transition-colors" placeholder="è¾“å…¥ç”¨æˆ·å">
            </div>

            <div id="email-field" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-2">é‚®ç®±</label>
                <input type="email" id="email" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:outline-none transition-colors" placeholder="your@email.com">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">å¯†ç </label>
                <div class="relative">
                    <input type="password" id="password" required class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:outline-none transition-colors" placeholder="è¾“å…¥å¯†ç ">
                </div>
            </div>

            <div id="captcha-container" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                    <i data-lucide="shield" class="w-4 h-4"></i> éªŒè¯ç 
                </label>
                <div class="flex gap-3 items-center">
                    <div id="captcha-question" class="flex-1 px-4 py-3 bg-orange-50 border-2 border-orange-200 rounded-xl text-center font-bold text-lg text-gray-900">
                    </div>
                    <input type="number" id="captcha-input" class="w-20 px-4 py-3 bg-white border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:outline-none text-center" placeholder="?">
                </div>
            </div>

            <button type="submit" class="w-full py-3 bg-orange-600 text-white rounded-xl font-medium hover:bg-orange-700 transition-all shadow-lg shadow-orange-200">
                æäº¤
            </button>
        </form>

        <div class="mt-4 text-center text-sm text-gray-500">
            <span id="switch-text">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ</span>
            <button onclick="toggleAuthMode()" id="switch-btn" class="text-orange-600 font-semibold hover:underline">å»æ³¨å†Œ</button>
        </div>
    </div>
</div>

<script>
    // --- 1. æ•°æ®çŠ¶æ€ ---
    const state = {
        isLoggedIn: false,
        user: null,
        currentPage: 'home',
        searchQuery: '',
        authMode: 'login',
        captcha: { num1: 0, num2: 0, operator: '+', answer: 0 },
        loading: true // æ–°å¢åŠ è½½çŠ¶æ€
    };

    // è¿™é‡Œçš„ data åˆå§‹ä¸ºç©ºï¼Œä¸å†ç¡¬ç¼–ç 
    let data = {
        links: [],
        projects: [],
        files: []
    };

    // --- 2. åˆå§‹åŒ–ä¸API ---
    document.addEventListener('DOMContentLoaded', () => {
        render();
        lucide.createIcons();
        fetchData(); // å¯åŠ¨æ•°æ®è·å–
    });

    // â˜… æ ¸å¿ƒä¿®æ”¹ï¼šä» Cloudflare API è·å–æ•°æ®
    async function fetchData() {
        try {
            // è¯·æ±‚ functions/api/data.js
            const response = await fetch('/api/data');

            if (!response.ok) {
                throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
            }

            const result = await response.json();

            // æ•°æ®å¤„ç†ï¼šLinks çš„ tags ä»å­—ç¬¦ä¸² "code,tool" è½¬ä¸ºæ•°ç»„
            data.links = (result.links || []).map(link => ({
                ...link,
                tags: link.tags ? link.tags.split(',') : []
            }));

            data.projects = result.projects || [];
            data.files = result.files || []; // æš‚æ—¶ä¸ºç©º

            state.loading = false;
            console.log("æ•°æ®åŠ è½½å®Œæˆ:", data);

            render(); // é‡æ–°æ¸²æŸ“é¡µé¢
            lucide.createIcons();
        } catch (error) {
            console.error("æ— æ³•è¿æ¥åˆ°åç«¯:", error);
            // å¯ä»¥åœ¨è¿™é‡ŒåŠ ä¸€ä¸ªé”™è¯¯æç¤º UI
            state.loading = false;
        }
    }

    // --- 3. æ¸²æŸ“é€»è¾‘ ---
    function render() {
        updateNav();
        const app = document.getElementById('app-content');

        if (state.currentPage === 'home') {
            app.innerHTML = renderHome();
        } else if (state.currentPage === 'links') {
            app.innerHTML = renderLinks();
        } else if (state.currentPage === 'projects') {
            app.innerHTML = renderProjects();
        } else if (state.currentPage === 'files') {
            app.innerHTML = renderFiles();
        } else if (state.currentPage === 'settings') {
            app.innerHTML = renderSettings();
        }

        lucide.createIcons();
    }

    function updateNav() {
        const desktopNav = document.getElementById('desktop-nav');
        const authButtons = document.getElementById('auth-buttons');
        const userMenu = document.getElementById('user-menu');

        if (state.isLoggedIn) {
            desktopNav.classList.remove('hidden');
            authButtons.classList.add('hidden');
            userMenu.classList.remove('hidden');
            userMenu.classList.add('flex');
        } else {
            desktopNav.classList.add('hidden');
            authButtons.classList.remove('hidden');
            userMenu.classList.add('hidden');
            userMenu.classList.remove('flex');
        }

        document.querySelectorAll('.nav-btn').forEach(btn => {
            if (btn.dataset.page === state.currentPage) {
                btn.className = 'nav-btn px-4 py-2 rounded-xl font-medium transition-all bg-orange-50 text-orange-600';
            } else {
                btn.className = 'nav-btn px-4 py-2 rounded-xl font-medium transition-all text-gray-600 hover:bg-gray-50';
            }
        });
    }

    // --- 4. é¡µé¢æ¨¡æ¿ ---

    function renderHome() {
        return `
                <div class="min-h-[80vh] flex items-center justify-center px-6 fade-in">
                    <div class="max-w-4xl w-full text-center">
                        <div class="mb-8">
                            <div class="inline-block p-5 bg-gradient-to-br from-orange-100 to-rose-100 rounded-3xl mb-4 shadow-sm">
                                <i data-lucide="folder" class="w-16 h-16 text-orange-600"></i>
                            </div>
                        </div>
                        <h1 class="text-5xl md:text-6xl font-bold mb-4 text-gray-900 tracking-tight">Riceee Hub</h1>
                        <p class="text-xl text-gray-600 mb-10">æˆ‘çš„ç§äººæ•°å­—èµ„æºåº“ä¸æ•´åˆåŒ…åŸºåœ°</p>

                        ${!state.isLoggedIn ? `
                            <div class="flex gap-4 justify-center">
                                <button onclick="openAuthModal('login')" class="px-8 py-3 bg-orange-600 text-white rounded-2xl font-medium hover:bg-orange-700 transition-all shadow-lg shadow-orange-200">ç«‹å³ç™»å½•</button>
                                <button onclick="openAuthModal('register')" class="px-8 py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-2xl font-medium hover:border-orange-600 hover:text-orange-600 transition-all">æ³¨å†Œè´¦å·</button>
                            </div>
                            <div class="grid md:grid-cols-3 gap-6 mt-20 text-left">
                                <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                    <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center mb-4"><i data-lucide="link-2" class="text-blue-600 w-5 h-5"></i></div>
                                    <h3 class="font-bold text-gray-900">é“¾æ¥æ”¶è—</h3>
                                    <p class="text-sm text-gray-500 mt-1">äº‘ç«¯åŒæ­¥çš„å¸¸ç”¨ä¹¦ç­¾</p>
                                </div>
                                <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                    <div class="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center mb-4"><i data-lucide="package" class="text-purple-600 w-5 h-5"></i></div>
                                    <h3 class="font-bold text-gray-900">é¡¹ç›®ä»“åº“</h3>
                                    <p class="text-sm text-gray-500 mt-1">ä»˜è´¹é¡¹ç›®å±•ç¤ºä¸ç®¡ç†</p>
                                </div>
                                <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                                    <div class="w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center mb-4"><i data-lucide="download" class="text-orange-600 w-5 h-5"></i></div>
                                    <h3 class="font-bold text-gray-900">å¤§å‹æ–‡ä»¶</h3>
                                    <p class="text-sm text-gray-500 mt-1">é«˜é€Ÿä¸‹è½½ Minecraft æ•´åˆåŒ…</p>
                                </div>
                            </div>
                        ` : `
                            <button onclick="navigateTo('links')" class="px-8 py-3 bg-orange-600 text-white rounded-2xl font-medium hover:bg-orange-700 transition-all inline-flex items-center gap-2 shadow-lg shadow-orange-200">
                                æ‰“å¼€èµ„æºåº“ <i data-lucide="arrow-right" class="w-4 h-4"></i>
                            </button>
                        `}
                    </div>
                </div>
            `;
    }

    function renderLinks() {
        if (state.loading) return renderSkeleton(); // å¦‚æœè¿˜åœ¨åŠ è½½æ•°æ®åº“ï¼Œæ˜¾ç¤ºéª¨æ¶å±

        const filtered = data.links.filter(l =>
            l.title.toLowerCase().includes(state.searchQuery.toLowerCase()) ||
            (l.tags && l.tags.some(t => t.includes(state.searchQuery)))
        );

        return `
                <div class="max-w-6xl mx-auto p-6 fade-in">
                    <div class="flex flex-wrap items-center justify-between gap-4 mb-8">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">å¿«æ·é“¾æ¥</h2>
                            <p class="text-sm text-gray-500 mt-1">å…± ${data.links.length} ä¸ªèµ„æº (æ¥è‡ª Cloudflare D1)</p>
                        </div>
                        <button class="px-4 py-2 bg-orange-600 text-white rounded-xl font-medium hover:bg-orange-700 transition-all flex items-center gap-2">
                            <i data-lucide="plus" class="w-4 h-4"></i> æ·»åŠ é“¾æ¥
                        </button>
                    </div>

                    <div class="relative mb-8">
                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                        <input type="text" placeholder="æœç´¢é“¾æ¥æˆ–æ ‡ç­¾..." value="${state.searchQuery}" oninput="handleSearch(this.value)"
                            class="w-full pl-12 pr-4 py-3 bg-white border-2 border-gray-100 rounded-xl focus:border-orange-500 focus:outline-none transition-colors shadow-sm">
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        ${filtered.length === 0 ? '<div class="col-span-2 text-center text-gray-400 py-10">æš‚æ— æ•°æ®æˆ–æ•°æ®åº“è¿æ¥ä¸­...</div>' : ''}
                        ${filtered.map(link => `
                            <div class="bg-white border border-gray-200 rounded-2xl p-5 hover:border-orange-300 hover:shadow-md transition-all group">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex-1">
                                        <a href="${link.url}" target="_blank" class="flex items-center gap-2 mb-1 group-hover:text-orange-600 transition-colors font-bold text-gray-900">
                                            ${link.title} <i data-lucide="external-link" class="w-3 h-3 text-gray-400"></i>
                                        </a>
                                        <p class="text-xs text-gray-400 truncate">${link.url}</p>
                                    </div>
                                    <i data-lucide="star" class="w-5 h-5 ${link.favorite ? 'fill-yellow-400 text-yellow-400' : 'text-gray-300'}"></i>
                                </div>
                                <div class="flex items-center justify-between mt-4">
                                    <div class="flex gap-2">
                                        ${link.tags ? link.tags.map(tag => `<span class="px-2 py-1 bg-gray-100 text-gray-600 rounded-lg text-xs font-medium">${tag}</span>`).join('') : ''}
                                    </div>
                                    <span class="text-xs text-gray-400 font-medium">${link.visits || 0} è®¿é—®</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
    }

    function renderProjects() {
        if (state.loading) return renderSkeleton();

        return `
                <div class="max-w-6xl mx-auto p-6 fade-in">
                    <div class="flex flex-wrap items-center justify-between gap-4 mb-8">
                        <h2 class="text-2xl font-bold text-gray-900">æˆ‘çš„é¡¹ç›®</h2>
                        <button class="px-4 py-2 bg-orange-600 text-white rounded-xl font-medium hover:bg-orange-700 transition-all flex items-center gap-2">
                            <i data-lucide="upload-cloud" class="w-4 h-4"></i> å‘å¸ƒé¡¹ç›®
                        </button>
                    </div>
                    <div class="space-y-4">
                        ${data.projects.length === 0 ? '<div class="text-center text-gray-400 py-10">æš‚æ— é¡¹ç›®æ•°æ®</div>' : ''}
                        ${data.projects.map(proj => `
                            <div class="bg-white border border-gray-200 rounded-2xl p-6 hover:border-orange-300 transition-all hover:shadow-md">
                                <div class="flex items-start justify-between flex-wrap gap-4">
                                    <div class="flex items-center gap-5 flex-1">
                                        <div class="w-14 h-14 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center shrink-0">
                                            <i data-lucide="package" class="w-7 h-7"></i>
                                        </div>
                                        <div>
                                            <div class="flex items-center gap-3 mb-1">
                                                <h3 class="font-bold text-lg text-gray-900">${proj.name}</h3>
                                                <span class="px-2 py-0.5 bg-green-100 text-green-700 rounded-md text-xs font-bold">${proj.status === 'active' ? 'åœ¨çº¿' : 'ä¸‹çº¿'}</span>
                                            </div>
                                            <div class="flex gap-4 text-sm text-gray-500 font-medium">
                                                <span class="flex items-center gap-1"><i data-lucide="hard-drive" class="w-3 h-3"></i> ${proj.size || 'æœªçŸ¥'}</span>
                                                <span class="flex items-center gap-1"><i data-lucide="download" class="w-3 h-3"></i> ${proj.downloads || 0}</span>
                                                <span class="${proj.price > 0 ? 'text-orange-600' : 'text-green-600'} font-bold">
                                                    ${proj.price > 0 ? 'Â¥' + proj.price : 'å…è´¹'}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="px-4 py-2 bg-orange-600 text-white rounded-xl text-sm font-bold hover:bg-orange-700 transition-all">è·å–</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
    }

    function renderFiles() {
        // æš‚æ—¶è¿˜æ˜¯ç¡¬ç¼–ç çš„å‡æ•°æ®æˆ–ç©ºæ•°æ®ï¼Œåç»­å¯¹æ¥ R2
        return `
                <div class="max-w-6xl mx-auto p-6 fade-in">
                    <div class="flex flex-wrap items-center justify-between gap-4 mb-8">
                        <h2 class="text-2xl font-bold text-gray-900">æœåŠ¡å™¨æ–‡ä»¶</h2>
                        <button class="px-4 py-2 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-all flex items-center gap-2">
                            <i data-lucide="upload" class="w-4 h-4"></i> ä¸Šä¼ æ–‡ä»¶
                        </button>
                    </div>
                    <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 text-center">
                        <p class="text-blue-800 font-medium mb-2">ğŸš§ æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ (R2) é…ç½®ä¸­...</p>
                        <p class="text-sm text-blue-600">è¯·å®Œæˆ Cloudflare R2 ç»‘å®šåå¼€å¯æ­¤åŠŸèƒ½ã€‚</p>
                    </div>
                </div>
            `;
    }

    function renderSettings() {
        return `
                <div class="max-w-2xl mx-auto p-6 fade-in">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">è´¦æˆ·è®¾ç½®</h2>
                    <div class="bg-white border-2 border-gray-100 rounded-3xl p-8 space-y-6">
                        <div class="flex items-center gap-5 pb-6 border-b border-gray-100">
                            <div class="w-20 h-20 bg-gradient-to-br from-orange-400 to-rose-500 rounded-full flex items-center justify-center text-3xl text-white font-bold shadow-lg">
                                ${state.user ? state.user.charAt(0).toUpperCase() : 'U'}
                            </div>
                            <div>
                                <h3 class="font-bold text-xl text-gray-900">${state.user}</h3>
                                <p class="text-sm text-gray-500">user@riceee.com</p>
                            </div>
                        </div>
                        <button class="w-full py-3 bg-gray-900 text-white rounded-xl font-bold hover:bg-black transition-all">ä¿å­˜æ›´æ”¹</button>
                    </div>
                </div>
            `;
    }

    function renderSkeleton() {
        return `
                <div class="max-w-6xl mx-auto p-6 space-y-4">
                    <div class="h-8 w-48 skeleton mb-8"></div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="h-32 skeleton"></div>
                        <div class="h-32 skeleton"></div>
                        <div class="h-32 skeleton"></div>
                        <div class="h-32 skeleton"></div>
                    </div>
                </div>
            `;
    }

    // --- 5. äº¤äº’é€»è¾‘ ---

    function navigateTo(page) {
        // æƒé™æ£€æŸ¥
        if (['links', 'projects', 'files', 'settings'].includes(page) && !state.isLoggedIn) {
            openAuthModal('login');
            return;
        }
        state.currentPage = page;
        render();
    }

    function handleSearch(val) {
        state.searchQuery = val;
        render();
        setTimeout(() => {
            const input = document.querySelector('input[type="text"]');
            if(input) {
                input.focus();
                input.value = val;
            }
        }, 0);
    }

    function generateCaptcha() {
        const num1 = Math.floor(Math.random() * 10) + 1;
        const num2 = Math.floor(Math.random() * 10) + 1;
        const ops = ['+', 'Ã—'];
        const operator = ops[Math.floor(Math.random() * ops.length)];
        let answer = operator === '+' ? num1 + num2 : num1 * num2;

        state.captcha = { num1, num2, operator, answer };

        const qDiv = document.getElementById('captcha-question');
        if(qDiv) qDiv.textContent = `${num1} ${operator} ${num2} = ?`;
    }

    function openAuthModal(mode) {
        state.authMode = mode;
        const modal = document.getElementById('auth-modal');
        const title = document.getElementById('modal-title');
        const emailField = document.getElementById('email-field');
        const switchText = document.getElementById('switch-text');
        const switchBtn = document.getElementById('switch-btn');
        const captchaContainer = document.getElementById('captcha-container');

        modal.classList.remove('hidden');

        if (mode === 'login') {
            title.textContent = 'ç™»å½•';
            emailField.classList.add('hidden');
            captchaContainer.classList.add('hidden');
            switchText.textContent = 'è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ';
            switchBtn.textContent = 'å»æ³¨å†Œ';
        } else {
            title.textContent = 'æ³¨å†Œè´¦å·';
            emailField.classList.remove('hidden');
            captchaContainer.classList.remove('hidden');
            switchText.textContent = 'å·²æœ‰è´¦å·ï¼Ÿ';
            switchBtn.textContent = 'å»ç™»å½•';
            generateCaptcha();
        }
    }

    function closeAuthModal() {
        document.getElementById('auth-modal').classList.add('hidden');
    }

    function toggleAuthMode() {
        openAuthModal(state.authMode === 'login' ? 'register' : 'login');
    }

    function handleAuthSubmit(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;

        if (state.authMode === 'register') {
            const inputAns = parseInt(document.getElementById('captcha-input').value);
            if (inputAns !== state.captcha.answer) {
                alert('éªŒè¯ç ç®—é”™å•¦ï¼å†è¯•ä¸€æ¬¡ã€‚');
                generateCaptcha();
                document.getElementById('captcha-input').value = '';
                return;
            }
        }

        state.isLoggedIn = true;
        state.user = username;
        closeAuthModal();
        navigateTo('links');
    }

    function logout() {
        if(confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
            state.isLoggedIn = false;
            state.user = null;
            navigateTo('home');
        }
    }

    document.getElementById('auth-modal').addEventListener('click', (e) => {
        if (e.target.id === 'auth-modal') closeAuthModal();
    });

</script>
</body>
</html>